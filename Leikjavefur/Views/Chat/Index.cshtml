@model dynamic

@{
    ViewBag.Title = "title";
   @* Layout = "_Layout";*@
}

<textarea disabled id="ChatArea">
</textarea>
<input id="TextBoxMessage" type="text" onkeypress="keyClicked(event)"/>
<input id="SendButton" type="button" value ="Senda"/>

<script>

    //Code in progress...
    function keyclicked(e)
    {
        if (e.keyCode == 13)
        {
            // Get the button the user wants to have clicked
            var btn = document.getElementById('SendButton');
            if (btn)
            {
                btn.click;
                return false;
            }
        }
    }

    var textArea = document.getElementById('ChatArea')
    $(function ()
    {
	    var group = @*'@(Model.ID)';*@ '1';
	    var hub = $.connection.communication;

		hub.client.ReceiveMessage = function (message) {
		    //document.getElementById('ChatArea').value += message;
		    //$('#ChatArea').val(message);
		    //var textArea = document.getElementById('ChatArea')
		    var text = document.createTextNode(message + '\n')
		    textArea.appendChild(text)
		    textArea.scrollTop = textArea.scrollHeight
		};

		$.connection.hub.start().done(function ()
		{
			hub.server.join(group);

			$("#SendButton").click(function ()
			{
			    var message = $('#TextBoxMessage').val()

			    if (message != '')
			    {

			        hub.server.sendMessage(group, $('#TextBoxMessage').val());
			        $('#TextBoxMessage').val('');
			        //$('#ChatArea').val(message);
			        //var textArea = document.getElementById('ChatArea')
			        var text = document.createTextNode(message + '\n')
			        textArea.appendChild(text)
			        textArea.scrollTop = textArea.scrollHeight
			        document.getElementById("TextBoxMessage").focus();
			    }
			});
		});
	});
</script>




@model Leikjavefur.ViewModels.ChatModel

@{
}

<textarea disabled id="ChatArea">
</textarea>
<input id="TextBoxMessage" type="text"/>
<input id="SendButton" type="button" value ="Senda" style="display: none;"/>

<script>

    $("#TextBoxMessage").keydown(function (event) {
        if (event.keyCode == 13) {
            $("#SendButton").click();
            return false;
        }
        return true;
    });

    var textArea = document.getElementById('ChatArea')
    $(function ()
    {
        var userName = '@(Model.UserName)';
        //var userID = '(Model.ID)';
        var group = '@(Model.gameInstance)';
	    var hub = $.connection.communication;

		hub.client.ReceiveMessage = function (message) {
		    var text = document.createTextNode(message + '\n');
		    textArea.appendChild(text);
		    textArea.scrollTop = textArea.scrollHeight;
		};

		$.connection.hub.start().done(function ()
		{
			hub.server.join(group);

			$("#SendButton").click(function ()
			{
			    if (userName != '') {
			        if (message != '') {
			            var message = userName + ": ";
			            message += $('#TextBoxMessage').val();
			            hub.server.sendMessage(group, $('#TextBoxMessage').val());
			            $('#TextBoxMessage').val('');
			            var text = document.createTextNode(message + '\n\r');
			            textArea.appendChild(text);
			            textArea.scrollTop = textArea.scrollHeight;
			            document.getElementById("TextBoxMessage").focus();
			        }
			    }
			    else {
			        $('#TextBoxMessage').val('');
			    }
			});
		});
	});
</script>



